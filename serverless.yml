service: laravel-demo

provider:
  name: aws
  region: ap-northeast-1
  stage: dev
  runtime: provided.al2

plugins:
  - ./vendor/bref/bref

package:
  exclude:
    - node_modules/**
    - public/storage
    - storage/**
    - tests/**

functions:
  website:
    handler: public/index.php
    timeout: 28 # in seconds (API Gateway has a timeout of 29 seconds)
    layers:
      - ${bref:layer.php-73-fpm}
    events:
      - http: 'ANY /'
      - http: 'ANY /{proxy+}'
  artisan:
    handler: artisan
    timeout: 120 # in seconds
    layers:
      - ${bref:layer.php-73} # PHP
      - ${bref:layer.console} # The "console" layer

#    environment:
#      variable2: value2

# resources:
#   Resources:
#     GatewayResponse:
#       Type: 'AWS::ApiGateway::GatewayResponse'
#       Properties:
#       ResponseParameters:
#         gatewayresponse.header.WWW-Authenticate: "'Basic'"
#       ResponseType: UNAUTHORIZED
#       RestApiId:
#         Ref: 'ApiGatewayRestApi'
#       StatusCode: '401'